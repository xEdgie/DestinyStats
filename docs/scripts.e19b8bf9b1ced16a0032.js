var token,authCode,membershipType,destinyMembershipId,iconPath,characterId1,characterId2,characterId3,apiKey="d05f3598eec243a59a65bff6c77abf4c";function Auth(){window.location="https://www.bungie.net/en/OAuth/Authorize?client_id=30715&response_type=code&state=6i0mkLx79Hp91nzWVeHrzHG4"}function getAuthCode(){authCode=window.location.search.substring(6,38);var e=window.location.search.substring(6,window.location.search.length);console.log(authCode),console.log(e)}function getToken(){console.log("Get token");var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){console.log("Got Token");var e=JSON.parse(this.responseText);token=e.access_token,console.log(e)}else 401==this.status?(console.error("Authentication error"),console.log(`AuthCode : ${authCode}, API Key : ${apiKey}`)):404==this.status?(console.error("Not found"),console.log(`AuthCode : ${authCode}, API Key : ${apiKey}`)):(console.error("error"),console.log(`AuthCode : ${authCode}, API Key : ${apiKey}`))},e.open("POST","https://www.bungie.net/Platform/App/OAuth/token/"),e.setRequestHeader("X-API-Key",apiKey),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send()}function getPlayer(){var e=document.getElementById("searchPlayer").value,t=new XMLHttpRequest;console.log("Started"),t.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText);membershipType=e.Response[0].membershipType,destinyMembershipId=e.Response[0].membershipId,console.log(iconPath=e.Response[0].iconPath),document.getElementById("platform").innerHTML=`Player Display Name :  ${e.Response[0].displayName}`,console.log(`Output : ${e.Response[0].displayName}`),getAccount()}},t.open("GET",`https://www.bungie.net/Platform/Destiny2/SearchDestinyPlayer/All/${e}/`,!0),t.setRequestHeader("X-API-Key",apiKey),t.send()}function getAccount(){document.getElementById("searchPlayer");var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText);characterId1=e.Response.profile.data.characterIds[0],characterId2=e.Response.profile.data.characterIds[1],characterId3=e.Response.profile.data.characterIds[2],console.log(characterId1),getCharacter(1),getCharacter(2),getCharacter(3)}},e.open("GET",`https://www.bungie.net/Platform/Destiny2/${membershipType}/Profile/${destinyMembershipId}/?components=profiles`),e.setRequestHeader("X-API-Key",apiKey),e.send()}function getCharacter(e){var t;document.getElementById(`class${e}`).innerHTML="Class : ",document.getElementById(`emblem${e}`).src="",document.getElementById(`light${e}`).innerHTML="Power Level : ",document.getElementById(`playTime${e}`).innerHTML="Hours Played : ",1==e?t=characterId1:2==e?t=characterId2:3==e&&(t=characterId3);var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var t=JSON.parse(this.responseText),a=`https://bungie.net${t.Response.character.data.emblemPath}`,n=t.Response.character.data.classType,s=t.Response.character.data.light,o=parseFloat(t.Response.character.data.minutesPlayedTotal)/60;document.getElementById(`class${e}`).innerHTML=0==n?"Class : Titan":1==n?"Class : Hunter":"Class : Warlock",document.getElementById(`emblem${e}`).src=a,document.getElementById(`light${e}`).innerHTML=`Power Level : ${s}`,document.getElementById(`playTime${e}`).innerHTML=`Hours Played : ${o}`}},a.open("GET",`https://www.bungie.net/Platform/Destiny2/${membershipType}/Profile/${destinyMembershipId}/Character/${t}/?components=characters`),a.setRequestHeader("X-API-Key",apiKey),a.send()}